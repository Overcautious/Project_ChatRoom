### 基于C++11开发的聊天室
#### 介绍
使用 C++实现的 ubuntu 环境下的聊天小项目，采用 C/S 架构，支持注册、登录、记录登录状态、群聊、心跳包检测功能。

#### 主要功能
1. 用户注册、登录、登录账户是否已经登录。
2. 心跳包检测机制，用于客户端判断自身是否掉线，以及服务端检测客户端在线状态。
3. LRU机制，用来服务端管理在线账户。
4. 可变参数线程池，动态数量的线程池，以满足不同请求量。
5. 数据报通信协议，防止数据粘包。
#### 服务端涉及到的技术点
* epoll多路IO转接机制
* 常用STL(vector, unordered_map, queue)
* 锁``mutex``，信号量``condition_variable``
* 智能指针(shared_ptr, unique_ptr)
* 使用std::function + std::bind绑定的方式实现回调函数
* 可变参数线程池(thread)
* jsoncpp解析json数据
* MySQL基本操作

#### 客户端涉及到的技术点
* 常用QT控件(QWidget, QListWidget, QLabel, QPushButton)
* QT信号与槽
* QJsonObject完成json数据的解析
* QTcpSocket连接服务器

---
### 具体功能实现：
- 通信协议
    - 开始1B表示这个数据包是登录请求、发送请求、登出请求等
    - 接下来2B表示用户的账号
    - 接下来1B表示数据包的数据格式，文本或图片
    - 接下来4B表示数据的大小
    - 最后就是真实数据了
    
- LRUCache管理机制
  - 由两部分组成，一个是unordered_map，另一个是链表，结点中保存了用户的账号以及链接信息。
  - 链表是按照最近请求顺序保存用户信息的，谁最近请求过，就把谁放在链表头部
  - 每次请求，都会对链表进行检查：从尾部往前，依次检查调用时间与当前时间的差值，如果超过了200s，则断定为用户已离线，从在线列表中移除


- 心跳包检测机制
  - 客户端每隔30秒发送一次心跳包，如果有数据读取或者发送，会重置这个等待时间。
  - 利用套接字发送write函数返回值判断是否发送成功，如果连续5次没有发送成功，则判定为掉线，进行重新连接。
  - 为了防止服务端压力太大，接收到的心跳包均不回复。用LRUCache结构保存在线用户信息，每次收到心跳包，都会对LRUCache调用一次get请求操作，这样就能够不回复心跳包也能够检测用户是否在线。
    
- 可变参数线程池
  - 为了避免浪费资源，即线程池中的部分线程一直接收不到任务，这样就造成了资源浪费，因此设计可变参数线程池
  - 线程池分为核心线程、非核心线程。在线程池启动的时候，会启动所有的核心线程池，当任务量较多的时候，会增加非核心线程池，已达到快速完成所有任务的目标
  - 非核心线程在空闲一定时间后，会自动进行回收线程，但是核心线程不会进行回收操作
    
---
### 未来的工作：
 -[ ] 实现用户私聊，用户单独建立群聊
 -[ ] 线程池能够接受任何类型带参数的任务函数

 ... 